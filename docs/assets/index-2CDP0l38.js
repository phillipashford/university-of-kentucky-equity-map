(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&d(f)}).observe(document,{childList:!0,subtree:!0});function l(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(n){if(n.ep)return;n.ep=!0;const c=l(n);fetch(n.href,c)}})();document.addEventListener("DOMContentLoaded",function(){const p=document.getElementById("categorySelect"),i=document.getElementById("subcategorySelect"),l=document.getElementById("variableSelect"),d=document.getElementById("submitBtn");let n,c={},f=!0,m,u;d.classList.add("opacity-50","cursor-not-allowed"),d.disabled=!0;async function O(){try{n=await(await fetch("data/acsVariables.json")).json(),x()}catch(e){console.error("Failed to load variables:",e)}}function x(){Object.keys(n).forEach(e=>{if(e==="_reference")return;const o=P(e,e);p.appendChild(o)}),v()}function v(){const e=p.value,o=Object.keys(n[e]);i.innerHTML="",o.forEach(t=>{let s=document.createElement("option");s.value=t,s.textContent=t,i.appendChild(s)}),w()}function w(){const e=p.value,o=i.value,t=n[e][o].variables;l.innerHTML="",Object.entries(t).forEach(([s,r])=>{let a=document.createElement("option");a.value=r.code,a.textContent=s,l.appendChild(a)}),f?l.options[0].classList.add("border-2","border-blue-500","shadow-lg"):l.options[0].classList.remove("border-2","border-blue-500","shadow-lg"),S()}function S(){const e=l.selectedOptions.length>0;d.disabled=!e,d.classList.toggle("opacity-50",!e),d.classList.toggle("cursor-not-allowed",!e),l.options[0].classList.remove("border-2","border-blue-500","shadow-lg")}function P(e,o){const t=document.createElement("option");return t.value=e,t.textContent=o,t}p.addEventListener("change",v),i.addEventListener("change",w),l.addEventListener("change",S);async function b(e,o,t){let s="",r="",a="";f?(e="fayette",s="Demographics",r="Population",o="B01001_001E",t="Total Population",l.options[0].classList.add("border-2","border-blue-500","shadow-lg"),f=!1):(o=l.value,t=l.options[l.selectedIndex].text),s=p.options[p.selectedIndex].text,r=i.options[i.selectedIndex].text,a=n[s][r].variables[t],console.log(a),e=e||document.querySelector('input[name="geography"]:checked').value,a.transform&&(o+=","+a.base),console.log("Selected variable:",o);const g={selectedVariable:o,geography:e};console.log("Sending request data to PHP backend:",g);const C=await(await fetch("https://contig.us/geogoblin/equity-map/api-gateway.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).json();console.log("Response from server:",C);const y=B(C);console.log("Parsed ACS data:",y),u=chroma.limits(Object.values(y).filter(q=>q>0),"q",5),m=chroma.scale(["#add8e6","#00008b"]).mode("lch").domain(u),j(t),T(e,y,t)}d.addEventListener("click",async()=>{await b()}),document.querySelectorAll('input[name="geography"]').forEach(e=>{e.addEventListener("change",async o=>{await b(o.target.value)})}),M();var h=L.map("map").setView([37.8393,-86],7.5);L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:19}).addTo(h);function T(e,o,t){Object.values(c).forEach(r=>{h.removeLayer(r)}),c={};const s=`data/${e}.geojson`;fetch(s).then(r=>r.json()).then(r=>{r.features.forEach(a=>{const g=a.properties[{fayette:"TRACTCE",counties:"COUNTYFP"}[e]];a.properties.variableValue=o[g]||0}),console.log("Merged GeoJSON with ACS data (not yet transformed):",r),c[e]=L.geoJson(r,{style:function(a){return{fillColor:I(a.properties.variableValue),weight:1,opacity:1,color:"white",fillOpacity:.7}},onEachFeature:function(a,g){const E=`<h3>${a.properties.NAMELSAD}</h3><p>${t}: ${a.properties.variableValue}</p><div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4" role="alert">
                            <p class="font-bold">Warning</p>
                            <p>Represented data are raw counts and are not yet standardized.</p>
                        </div>
                        `;g.bindPopup(E)}}).addTo(h),e==="fayette"?h.setView([38.0406,-84.5037],11.25):h.setView([37.8393,-86],7.5)}).catch(r=>console.error("Error loading the GeoJSON:",r))}async function M(){await O(),await b()}function j(e){const o=document.getElementById("legendTitle"),t=document.getElementById("legendValues");o.textContent="Selected Variable: "+e,document.querySelectorAll("#legendScale div").forEach((r,a)=>{u&&a<u.length&&(r.style.backgroundColor=m(u[a]).hex())}),u.length>0&&(t.children[0].textContent="Min: "+u[0],t.children[t.children.length-1].textContent="Max: "+u[u.length-1])}function B(e){let o={};for(let t=1;t<e.length;t++){const s=e[t],r=s[s.length-1],a=s[0];o[r]=parseInt(a,10)}return o}function I(e){return e===0?"#f0f0f0":m(e).hex()}});
