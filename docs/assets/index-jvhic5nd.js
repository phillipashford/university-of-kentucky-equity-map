(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const p of r.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&d(p)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();document.addEventListener("DOMContentLoaded",function(){const f=document.getElementById("categorySelect"),l=document.getElementById("subcategorySelect"),i=document.getElementById("variableSelect"),d=document.getElementById("submitBtn");let n,r={},p=!0,b,u;d.classList.add("opacity-50","cursor-not-allowed"),d.disabled=!0;async function w(){try{n=await(await fetch("data/acsVariables.json")).json(),V()}catch(e){console.error("Failed to load variables:",e)}}function V(){Object.keys(n).forEach(e=>{if(e==="_reference")return;const o=x(e,e);f.appendChild(o)}),S()}function S(){const e=f.value,o=Object.keys(n[e]);l.innerHTML="",o.forEach(t=>{let c=document.createElement("option");c.value=t,c.textContent=t,l.appendChild(c)}),E()}function E(){const e=f.value,o=l.value,t=n[e][o].variables;i.innerHTML="",Object.entries(t).forEach(([c,s])=>{let a=document.createElement("option");a.value=s.code,a.textContent=c,i.appendChild(a)}),C()}function C(){const e=i.selectedOptions.length>0;d.disabled=!e,d.classList.toggle("opacity-50",!e),d.classList.toggle("cursor-not-allowed",!e)}function x(e,o){const t=document.createElement("option");return t.value=e,t.textContent=o,t}f.addEventListener("change",S),l.addEventListener("change",E),i.addEventListener("change",C);async function y(e){let o="",t="",c="",s="",a="";p?(o="B01001_001E",t="Total Population",p=!1):(o=i.value,t=i.options[i.selectedIndex].text,c=f.options[f.selectedIndex].text,s=l.options[l.selectedIndex].text,a=n[c][s].variables[t],console.log(a)),e=e||document.querySelector('input[name="geography"]:checked').value,a.transform&&(o+=","+a.base),console.log("Selected variable:",o);const g={selectedVariable:o,geography:e};console.log("Sending request data to PHP backend:",g);const m=await(await fetch("https://contig.us/geogoblin/equity-map/api-gateway.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).json();console.log("Response from server:",m),m.status==="success"?console.log("Request URL:",m.url):m.status==="error"&&console.log("Failed Request URL:",m.url);const v=M(m);console.log("Parsed ACS data:",v),u=chroma.limits(Object.values(v).filter(B=>B>0),"q",5),b=chroma.scale(["#add8e6","#00008b"]).mode("lch").domain(u),q(t),P(e,v,t)}d.addEventListener("click",async()=>{await y()}),document.querySelectorAll('input[name="geography"]').forEach(e=>{e.addEventListener("change",async o=>{p=!0,await y(o.target.value),p=!1})}),w(),T();var h=L.map("map").setView([37.8393,-86],7.5);L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:19}).addTo(h);function P(e,o,t){Object.values(r).forEach(s=>{h.removeLayer(s)}),r={};const c=`data/${e}.geojson`;fetch(c).then(s=>s.json()).then(s=>{s.features.forEach(a=>{const g=a.properties[{fayette:"TRACTCE",counties:"COUNTYFP"}[e]];a.properties.variableValue=o[g]||0}),console.log("Merged GeoJSON with ACS data (not yet transformed):",s),r[e]=L.geoJson(s,{style:function(a){return{fillColor:j(a.properties.variableValue),weight:1,opacity:1,color:"white",fillOpacity:.7}},onEachFeature:function(a,g){const O=`<h3>${a.properties.NAMELSAD}</h3><p>${t}: ${a.properties.variableValue}</p>`;g.bindPopup(O)}}).addTo(h),e==="fayette"?h.setView([38.0406,-84.5037],11.25):h.setView([37.8393,-86],7.5)}).catch(s=>console.error("Error loading the GeoJSON:",s))}function T(){y("fayette")}function q(e){const o=document.getElementById("legendTitle"),t=document.getElementById("legendValues");o.textContent="Selected Variable: "+e,document.querySelectorAll("#legendScale div").forEach((s,a)=>{u&&a<u.length&&(s.style.backgroundColor=b(u[a]).hex())}),u.length>0&&(t.children[0].textContent="Min: "+u[0],t.children[t.children.length-1].textContent="Max: "+u[u.length-1])}function M(e){let o={};for(let t=1;t<e.length;t++){const c=e[t],s=c[c.length-1],a=c[0];o[s]=parseInt(a,10)}return o}function j(e){return e===0?"#f0f0f0":b(e).hex()}});
