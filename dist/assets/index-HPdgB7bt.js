(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&d(p)}).observe(document,{childList:!0,subtree:!0});function i(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(n){if(n.ep)return;n.ep=!0;const c=i(n);fetch(n.href,c)}})();document.addEventListener("DOMContentLoaded",function(){const f=document.getElementById("categorySelect"),l=document.getElementById("subcategorySelect"),i=document.getElementById("variableSelect"),d=document.getElementById("submitBtn");let n,c={},p=!0,h,u;d.classList.add("opacity-50","cursor-not-allowed"),d.disabled=!0;async function w(){try{n=await(await fetch("data/acsVariables.json")).json(),V()}catch(e){console.error("Failed to load variables:",e)}}function V(){Object.keys(n).forEach(e=>{if(e==="_reference")return;const o=x(e,e);f.appendChild(o)}),v()}function v(){const e=f.value,o=Object.keys(n[e]);l.innerHTML="",o.forEach(t=>{let s=document.createElement("option");s.value=t,s.textContent=t,l.appendChild(s)}),S()}function S(){const e=f.value,o=l.value,t=n[e][o].variables;i.innerHTML="",Object.entries(t).forEach(([s,r])=>{let a=document.createElement("option");a.value=r.code,a.textContent=s,i.appendChild(a),console.log(s,r.code)}),E()}function E(){const e=i.selectedOptions.length>0;d.disabled=!e,d.classList.toggle("opacity-50",!e),d.classList.toggle("cursor-not-allowed",!e)}function x(e,o){const t=document.createElement("option");return t.value=e,t.textContent=o,t}f.addEventListener("change",v),l.addEventListener("change",S),i.addEventListener("change",E);async function b(e){let o="",t="",s="",r="",a="";p?(o="B01001_001E",t="Total Population",p=!1):(o=i.value,t=i.options[i.selectedIndex].text,s=f.options[f.selectedIndex].text,r=l.options[l.selectedIndex].text,a=n[s][r].variables[t],console.log(a)),e=e||document.querySelector('input[name="geography"]:checked').value,a.transform&&(o+=","+a.base,console.log("Selected variable with transform:",o)),console.log("Selected variable:",o);const g={selectedVariable:o,geography:e};console.log("Sending request data to PHP backend:",g);const O=await(await fetch("https://contig.us/geogoblin/equity-map/api-gateway.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).json();console.log("Response from server:",O);const y=j(O);console.log("Parsed ACS data:",y),u=chroma.limits(Object.values(y).filter(I=>I>0),"q",5),h=chroma.scale(["#add8e6","#00008b"]).mode("lch").domain(u),M(t),P(e,y,t)}d.addEventListener("click",async()=>{await b()}),document.querySelectorAll('input[name="geography"]').forEach(e=>{e.addEventListener("change",async o=>{p=!0,await b(o.target.value),p=!1})}),w(),T();var m=L.map("map").setView([37.8393,-86],7.5);L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:19}).addTo(m);function P(e,o,t){Object.values(c).forEach(r=>{m.removeLayer(r)}),c={};const s=`data/${e}.geojson`;fetch(s).then(r=>r.json()).then(r=>{r.features.forEach(a=>{const g=a.properties[{fayette:"TRACTCE",counties:"COUNTYFP"}[e]];a.properties.variableValue=o[g]||0}),console.log("Merged GeoJSON with ACS data:",r),c[e]=L.geoJson(r,{style:function(a){return{fillColor:B(a.properties.variableValue),weight:1,opacity:1,color:"white",fillOpacity:.7}},onEachFeature:function(a,g){const C=`<h3>${a.properties.NAMELSAD}</h3><p>${t}: ${a.properties.variableValue}</p>`;g.bindPopup(C)}}).addTo(m),e==="fayette"?m.setView([38.0406,-84.5037],11.25):m.setView([37.8393,-86],7.5)}).catch(r=>console.error("Error loading the GeoJSON:",r))}function T(){b("fayette")}function M(e){const o=document.getElementById("legendTitle"),t=document.getElementById("legendValues");o.textContent="Selected Variable: "+e,document.querySelectorAll("#legendScale div").forEach((r,a)=>{u&&a<u.length&&(r.style.backgroundColor=h(u[a]).hex())}),u.length>0&&(t.children[0].textContent="Min: "+u[0],t.children[t.children.length-1].textContent="Max: "+u[u.length-1])}function j(e){let o={};for(let t=1;t<e.length;t++){const s=e[t],r=s[s.length-1],a=s[0];o[r]=parseInt(a,10)}return o}function B(e){return e===0?"#f0f0f0":h(e).hex()}});
